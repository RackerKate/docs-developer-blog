---
layout: post
title: "New performance-tuning features of Oracle Database 12c Release 12.1.0.0: Part 2"
date: 2018-09-25 00:00
comments: true
author: Virat Choudhary
published: true
authorIsRacker: true
categories:
  - Oracle
  - database
---

Originally published by TriCore: April 12, 2017

This two-part blog post series covers new performance-tuning features in
Oracle&reg; Database. Part 1 discussed Oracle Database version 12.1.0.1. This
follow-up post covers version 12.1.0.2.

<!-- more -->

### Introduction to In-Memory column store

In-memory column store (IM column store) is an optional area of the System Global Area (SGA) that stores copies of tables, partitions, and other database objects in a columnar format that is optimized for rapid scans. IM column store accelerates database performance of analytics, data warehousing, and online transaction processing (OLTP) applications.

### How IM column store works

IM column store stores copies of tables, partitions, and other database objects in the SGA. It does not replace the database buffer cache. Both memory areas can store the same data in different formats. Rows stored in the IM column store are divided into large memory regions in a columnar format. A column resides separately in a contiguous area of memory within each region.

You can enable the IM column store for any of the following database objects:

- Tables
- Materialized views
- Partitions
- Tablespaces

You can opt to store all columns of a table or a materialized view in the In-Memory Column Store, or only a subset of its columns. Similarly, for a partitioned table, you can opt to store all of the table's partitions in the In-Memory Column Store, or only a subset of the partitions. If we enable the In-Memory Column Store at the tablespace level, it will automatically enable all the tables and materialized views in the tablespaces for the IM column store.

### Performance benefits of using IM column store

By storing database objects in memory, an Oracle Database can perform scans, queries, joins, and aggregates much faster than on disk. The In-Memory Column Store can significantly improve performance when:

- Scanning a large number of rows and applying filters, such as <, >, =, and
  IN.
- Querying a small subset of columns from a large number of columns
- Joining a small table to a large table, particularly when join conditions
  filter most of the rows.
- Aggregating data in a query.

IM column store also improves the performance of data manipulation language (DML) statements. Online transaction processing (OLTP) systems typically require many indexes to be created on commonly accessed columns. These indexes may impact negatively on performance of DML statements. When a database object is stored in the In-Memory Column Store, these indexes can be eliminated because scans run much faster. Eliminating the number of indexes improves the performance of DML statements because fewer indexes need to be updated.

<INSERT IMAGE!!>

Image source: [Oracle Learning Library YouTube videos: Oracle Database 12c
demos: In-Memory Column Store Architecture
Overview](https://www.youtube.com/watch?v=fMW2-TDheec)

**Estimating the required size of the IM column store**

The IM column store supports the following compression methods:

<INSERT TABLE>

The following example shows how to enable the `oe.product_information` table for the IM column store and specifies the compression method `MEMCOMPRESS FOR CAPACITY HIGH`.

    SQL>ALTER TABLE oe.product_information INMEMORY MEMCOMPRESS FOR CAPACITY HIGH;

### Sizing the IM column store

After determining the memory required to store database objects in the In-Memory Column Store based on their compression methods, we can set its size by using the `INMEMORY_SIZE` initialization parameter.

To set the size of the IM column store, use the following steps:

- Set the `INMEMORY_SIZE` initialization parameter to the required size.

The default value of this parameter is `0`, which means that the IM column store is not used. To enable the IM column store, set this parameter to a nonzero value. In a multitenant environment, you can set this parameter per pluggable database (PDB) to specify the size of the IM column store for each PDB. The sum of the PDB values does not have to equal the value for the container database (CDB), and may even be greater. After setting the size of the IM column store, you must restart your database instance to enable the database objects to be stored in it.

The following example shows how to set the size of the IM column Store to 100
GB.

    ALTER SYSTEM SET INMEMORY_SIZE = 100G;
----------------------------------------------------------------------------------------------------------------------------------
B)  Manageability support for IM column store
SQL Monitor report, ASH report, and AWR report now show statistics for various in-memory operations.

C)  Force full database caching mode
Force full database caching mode enables us to cache the entire database in memory, which may provide substantial performance improvements when performing full table scans or accessing LOBs.

Configuring the database caching mode
There are two database caching modes. The default database caching mode used in previous versions of Oracle Database, and the force full database caching mode that is new to this release-Oracle Database 12c Release 1 (12.1.0.2). In default caching mode, Oracle Database does not always cache the underlying data when a user queries a large table. In force full database caching mode, Oracle Database assumes that the buffer cache is large enough to cache the full database and tries to cache all the blocks that are accessed by queries.

### Default Database Caching Mode

By default, Oracle Database uses the default database caching mode when it
performs full table scans.

If the Oracle Database instance determines that there is enough space to cache the full database in the buffer cache and that it would be beneficial to do so, then the instance automatically caches the full database in the buffer cache.

If the Oracle Database instance determines that there isn't enough space to cache the full database in the buffer cache, it performs the following tasks:

- Smaller tables are loaded into memory when the table size is less than two percent of the buffer cache size.
- For medium-sized tables, Oracle Database analyses the interval between the last table scan and the aging timestamp of the buffer cache. If the size of the table reused in the last table scan is greater than the remaining buffer cache size, then the table is cached.
- Large tables are not loaded into memory, unless if we explicitly declare the table for the KEEP buffer pool.

Force Full Database Caching Mode

In force full database caching mode, Oracle Database caches the entire database in memory when the size of the database is smaller than the database buffer cache size. All data files, including NOCACHE LOBs and LOBS that use SecureFiles, are loaded into the buffer cache as they are being accessed.

Image source: Oracle Learning Library YouTube videos: Full DB In-Memory Caching: https://www.youtube.com/watch?v=jLtdDPmb1Ws

### When to Use Force Full Database Caching Mode

Consider using force full database caching mode in the following situations:

- The logical database size (or actual used space) is smaller than the individual buffer cache of each database instance in an Oracle RAC environment. (Applicable for non-Oracle RAC database as well)
- The logical database size is smaller than 80% of the combined buffer cache sizes of all the database instances for well-partitioned workloads (by instance access) in an Oracle RAC environment.
- The database uses `SGA_TARGET` or `MEMORY_TARGET`.
- The `NOCACHE` LOBs need to be cached. The `NOCACHE` LOBs are never cached unless force full database caching is used.

For the first three situations, you should monitor the system performance periodically to verify that the performance figures are according to your expectations.

When one Oracle RAC database instance uses the force full database caching mode, then all the other database instances in the Oracle RAC environment also use force full database caching mode.

In a multitenant environment, force full database caching mode applies to the entire CDB, including all of its PDBs.

**Setup & Verifying the Database Caching Mode**

By default, Oracle Database runs in the default database caching mode.

Check your database and memory size. `SYSAUX` tablespace can be excluded, as shown in the following example:

```
SQL> col size_mb format 9999
SQL> SELECT sum(bytes)/1024/1024 seg_size_mb FROM dba_segments where tablespace_name != 'SYSAUX';
SEG_SIZE_MB
-----------
4971
```

Use the following command to check the size of the buffer cache:

```
SQL> SELECT round(sum(cnum_set * blk_size)/1024/1024) size_mb FROM X$KCBWDS;
SIZE_MB
-------
5283
```

Use the following steps to configure your database forâ€¯force full database
caching:
```
SQL> startup mount;
Database mounted.

SQL> ALTER DATABASE FORCE FULL DATABASE CACHING;
Database altered.

SQL> SELECT force_full_db_caching FROM v$database;
FOR
---
YES

SQL> alter database open;
Database altered.
```

To verify that force full database caching mode is enabled, use the following
steps:

1. Use the following command to query the `V$DATABASE` view:

       SQL>SELECT FORCE_FULL_DB_CACHING FROM V$DATABASE;

   The output is either `YES` or `NO`.

2. To enable force full database caching mode, use the following `ALTER
   DATABASE` command:

       ALTER DATABASE FORCE FULL DATABASE CACHING;

       Database altered.

3. To disable force full database caching, use the following command:

       SQL> ALTER DATABASE NO FORCE FULL DATABASE CACHING;

       Database altered.

### Conclusion

In summary, IM column store reduces execution time for DML statements. Oracle Enterprise Manager (OEM) shows detailed reports for new features. Finally, force full database caching mode offers significant performance improvements.

### References

The following articles were used as references for this blog post:

- [OCP 12c - Emergency Monitoring, Real-Time
ADDM](https://www.dba-scripts.com/articles/ocp-flashcards/ocp-12c-emergency-monitoring-real-time-addm/)

- [Database Performance Tuning Guide: Automatic Performance
Diagnostics](https://docs.oracle.com/database/121/TGDBA/pfgrf_diag.htm#TGDBA94242)
